seed: 0
device: auto
dtype: float32
state_dtype: complex64
data:
  family: regular
  N: 64
  seed: 1234
  directed: false
  grid:
    Lx: 8
    Ly: 8
  regular:
    d: 3
  er:
    p: 0.05
  ws:
    Lx: 8
    Ly: 8
    kx: 1
    ky: 1
    beta: 0.2
    torus: false
  train_sizes:
    mode: fixed_list
    fixed_list:
    - 64
    - 96
    - 128
    - 160
    - 192
  val_sizes:
    mode: fixed_list
    fixed_list:
    - 72
    - 136
    - 184
  test_iid_sizes:
    mode: fixed_list
    fixed_list:
    - 96
    - 128
    - 160
  test_ood_sizes:
    mode: fixed_list
    fixed_list:
    - 256
  batching:
    episodes_per_graph: 1
    graphs_per_batch_train: 2
    graphs_per_batch_eval: 1
    shuffle_train: true
  manifests:
    enabled: true
    root_dir: acpl/data/manifests
    val_manifest: transfer-regular-val.json
    test_iid_manifest: transfer-regular-test-iid.json
    test_ood_manifest: transfer-regular-test-ood.json
    episodes:
      val: 120
      test_iid: 120
      test_ood: 150
    build:
      seed: 1234
      episode_seed_base: 910000
      horizon_policy: per_horizon_manifest
      per_horizon:
        enabled: true
        horizons:
        - 64
        - 96
        - 128
features:
  use_degree: true
  degree_onehot_K: 16
  degree_log1p: false
  degree_norm: inv_sqrt
  use_coords: true
  coords_normalize: true
  use_indicator: false
  use_lap_pe: true
  lap_pe_k: 16
  lap_pe_norm: sym
  lap_pe_random_sign: true
  use_rwse: true
  rwse_K: 16
  rwse_aggregation: diag
  use_role_encodings: true
  role_degree_bins_K: 8
  role_include_leaf: true
  role_include_hub: true
  role_hub_percentile: 0.9
  role_include_grid_boundary: true
  use_bitstrings: false
  build_arcs: false
  eps: 1.0e-12
  seed: 42
  include_degree: true
  laplacian_pe:
    enabled: true
    k: 16
    sign_fix: max-abs-positive
  coords:
    enabled: false
sim:
  steps: 64
  horizons:
    candidates:
    - 64
    - 96
    - 128
    choose_on_val: true
    criterion_metric: eval/target/success
    tie_break: smaller_T
  rollout:
    check_unitarity: false
    check_simplex_every: 0
task:
  name: transfer
  target_index: -1
  target_radius: 0
  init_state: node0
  use_indicator: false
  objective: maximize P_T(target)
  normalized_time_feature: true
  source: custom_index
  target: custom_index
  source_index: 0
  loss:
    kind: nll
    time_agg: last
    cvar_alpha: 0.1
    reduction: mean
    eps: 1.0e-08
    clamp_min_p: 1.0e-12
    normalize_prob: true
loss:
  kind: nll
  reduction: mean
  normalize_prob: true
  eps: 1.0e-08
  margin: 0.0
  cvar_alpha: 0.1
  mix_kind: tv
  mix_eps: 1.0e-12
model:
  gnn:
    kind: gcn
    hidden: 64
    out: 64
    dropout: 0.0
    layers: 3
    hidden_dim: 128
    norm: graphnorm
    residual: true
  controller:
    kind: gru
    hidden: 64
    layers: 2
    dropout: 0.0
    bidirectional: false
    hidden_dim: 128
    time_pe_dim: 32
    normalized_time_feature: true
  head:
    hidden: 0
    dropout: 0.0
    layernorm: true
  time_pe_dim: 32
  time_pe_learned_scale: true
  coin:
    family: exp
    theta_scale: 1.0
    theta_noise_std: 0.0
coin:
  family: exp
  theta_scale: 1.0
  theta_noise_std: 0.0
  auto_fix_notes:
    reason: su2 invalid for max-degree>2 graphs; auto-switched
    from: su2
    to: exp
    graph_family: regular
optim:
  name: adamw
  lr: 0.00025
  weight_decay: 0.0
  betas:
  - 0.9
  - 0.999
  grad_clip:
    enabled: true
    mode: norm
    max_norm: 1.0
  precision:
    amp: true
  scheduler:
    kind: cosine_warmup
    cosine_warmup:
      warmup_steps: 200
      t_max: 8000
      eta_min: 1.0e-05
  eps: 1.0e-08
  regularizers:
    temporal_smoothness: 0.001
    magnitude: 5.0e-05
    spectral:
      enabled: true
      dct_weight: 5.0e-05
      hf_bins: 0.25
train:
  epochs: 120
  batch_size: 1
  episodes_per_epoch: 200
  verify_checkpoints: true
  ci_n_seeds: 5
  ci_episodes: 100
  run_dir: runs/transfer-regular/seed0
log:
  backend: console
  interval: 50
  ci_bootstrap_samples: 1000
  ci_alpha: 0.05
  wandb:
    enabled: false
    project: acpl-qwalk
    run_name: A6_line64_T64_gcn_gru_su2
compile:
  enabled: true
  backend: aot_eager
  force_inductor: false
experiment:
  name: transfer-regular
  goal: transfer to fixed target on d-regular random graphs
  description: 'Pre-registered evaluation of ACPL for state transfer on d-regular
    random graphs. Uses any-degree coin parameterizations (exp/cayley) and compares
    against global baselines and ablations. Reports IID and OOD size generalization.

    '
  tags:
  - transfer
  - regular
  - ood
  - ablations
  - baselines
  - ci
  - embeddings
  - stats
  notes: 'Regular graphs remove geometric shortcuts present in lines/grids; successful
    transfer requires learned, structure-sensitive coin schedules. Evaluation uses
    frozen manifests.

    '
defaults:
  task_config: acpl/configs/task/transfer.yaml
  optim_config: acpl/configs/optim.yaml
repro:
  master_seed: 1234
  train_seeds:
  - 0
  - 1
  - 2
  - 3
  - 4
  eval_seeds:
  - 111
  - 112
  - 113
  - 211
  - 212
  deterministic_torch: true
  cublas_workspace_config: :4096:8
  pythonhashseed: 0
  save_git_info: true
  save_resolved_config: true
training:
  method: backprop
  epochs: 50
  steps_per_epoch: 256
  accum_steps: 1
  amp: true
  device: cuda
  log_every: 50
  log_grad_norm_every: 200
  ckpt:
    dir: checkpoints/transfer-regular
    keep_last: 6
    save_every_steps: 2000
    save_best_metric: eval/target/success
comparisons:
  baselines:
  - name: fixed_grover
    enabled: true
    description: Fixed Grover diffusion coin on d-regular graphs.
  - name: global_time_coin
    enabled: true
    description: "\u03B8(t) learned but shared across nodes (tests node adaptivity)."
  - name: node_only_coin
    enabled: true
    description: "\u03B8(v) learned but constant over time (tests time adaptivity)."
  - name: fixed_random_unitary
    enabled: true
    description: Seeded random fixed unitary coin baseline (degree-aware).
  ablations:
  - name: no_lappe
    enabled: true
    description: Disable Laplacian positional encodings.
  - name: smooth0
    enabled: true
    description: Set temporal_smoothness=0.
  - name: mag0
    enabled: true
    description: Set magnitude regularizer=0.
  - name: spectral0
    enabled: true
    description: Disable spectral (DCT) regularizer.
eval:
  enabled: true
  ci:
    alpha: 0.1
    n_eval_seeds: 5
    episodes_per_seed:
      val: 80
      test_iid: 80
      test_ood: 100
    method: bootstrap
    bootstrap:
      n_resamples: 2000
      block_by: episode
  metrics:
  - target/success
  - target/maxp
  - target/nll
  - mix/tv
  - mix/H
  artifacts:
    write_dir: eval
    write_ci: true
    write_per_seed: true
    write_tables: true
    write_json: true
    stats:
      enabled: true
      quantiles:
      - 0.05
      - 0.25
      - 0.5
      - 0.75
      - 0.95
      include_probability_checks: true
      include_time_series: true
    embeddings:
      enabled: true
      source: gnn
      aggregate_time: last
      max_nodes_for_plot: 2048
      pca:
        enabled: true
        n_components: 2
      color_by:
      - degree
      save:
        raw_pt: true
        raw_csv: true
        pca_csv: true
        pca_png: true
        stats_json: true
    plots:
      enabled: true
      pt_timeline: true
      tv_curve: true
      theta_spectra: true
success_criteria:
  transfer_threshold:
    metric: target/success
    split: test_ood
    min_value: 0.9
  ci_improvement_over_best_baseline:
    metric: target/success
    split: test_ood
    min_abs_improvement: 0.02
compute:
  device: auto
  dtype:
    encoder: float32
    state: complex128
  amp: true
  wallclock_hours: 4
  max_memory_gb: 8
  track_throughput: true
